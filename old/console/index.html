<!DOCTYPE html>
<html lang="en">
    <head>
        <title>AirdataDB - Home</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="theme-color" content="#008AAA">
        <link href='//fonts.googleapis.com/css?family=Titillium+Web:400,400italic,600,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/2.1.13/daterangepicker.min.css">
        <link rel="stylesheet" href="../css/bootstrap-multiselect/bootstrap-multiselect.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.20/require.min.js"></script>
        <!--AirdataDB js -->
        <!--AirdataDB css-->
        <link rel="stylesheet" type="text/css" href="../css/default.css">
        <link rel="icon" type="image/png" href="../img/favicon_wbg.png">
    </head>
    <body class="page" style="display: none"><!--header-->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <!--<a class="navbar-brand" href="./"><img alt="AirdataDB" src="img/icon.svg" class="img-responsive" title="AirdataDB" style="height:100%;"></a>-->
                    <a href="../" class="navbar-brand"><strong>AirdataDB</strong></a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <!--<li><a href="./" class="navbarmstitle">AirdataDB</a></li>-->
                        <li class="dropdown active">
                            <a href="../status" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Status <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="../status"><span class="glyphicon glyphicon-ok-sign" style="color:green;"></span> AirdataDB</a></li>
                                <li class="divider"></li>
                                <li><a href="../status"><span class="glyphicon glyphicon-ok-sign" style="color:green;"></span> MetaCalendar</a></li>
                                <li class="divider"></li>
                                <li><a href="../status"><span class="glyphicon glyphicon-info-sign" style="color:orange;"></span> MetaDisplay</a></li>
                                <li class="divider"></li>
                                <li><a href="../status">Full Status</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">My AirdataDB <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#"><strong>Reporting</strong></a></li>
                                <li><a href="../my/reporting/auth">Live Dashboards</a></li>

                                <li><a href="../my/reporting/sec">Scheduled Reports</a></li>
                                <li class="divider"></li>
                                <li><a href="#"><strong>Personalization</strong></a></li>
                                <li><a href="../my/personalization/filters">Private Filters</a></li>
                                <li><a href="../my/personalization/pruning">Pruning Rules</a></li>
                                <li class="divider"></li>
                                <li><a href="#"><strong>Logging</strong></a></li>
                                <li><a href="../my/logging/stats">Statistics</a></li>
                                <li><a href="../my/logging/logs">Raw Logs</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Docs <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="./docs/start">Getting Started</a></li>
                                <li class="divider"></li>
                                <li><a href="./docs/ms/"><strong>AirdataDB</strong></a></li>
                                <li><a href="./docs/ms/samples">Sample Requests & Responses</a></li>
                                <li><a href="./docs/ms/docs">Documentation</a></li>
                                <li class="divider"></li>
                                <li><a href="./docs/mc/"><strong>MetaCalendar</strong></a></li>
                                <li><a href="./docs/mc/samples">Sample Requests & Responses</a></li>
                                <li><a href="./docs/mc/docs">Documentation</a></li>
                                <li><a href="./docs/mc/lib">JavaScript Integration</a></li>
                                <li class="divider"></li>
                                <li><a href="./docs/md"><strong>MetaDisplay</strong></a></li>
                                <li><a href="./docs/md/samples">Sample Requests & Responses</a></li>
                                <li><a href="./docs/md/docs">Documentation</a></li>
                                <li><a href="./docs/md/lib">JavaScript Integration</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Support <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#"><strong>Self-Service</strong></a></li>
                                <li><a href="./support/forum">Forum</a></li>
                                <li class="divider"></li>
                                <li><a href="#"><strong>Support Contact Options</strong></a></li>
                                <li><a href="#">Live Support Chat <span class="glyphicon glyphicon-comment" style="color:green;"></span></a></li>
                                <li><a href="#">Submit Email Support Ticket</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">My Account <span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="./account/info">Account Information</a></li>
                                <li><a href="./account/billing">Billing Details</a></li>
                                <li><a href="./account/billinglogging">Billing logging</a></li>
                                <li class="divider"></li>
                                <li><a href="#" id="logout">Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
        <!--endheader-->
        <div class="container-fluid">
            <!--<div class="alert alert-success alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>Welcome to AirdataDB. If this is your first time, <a href="#">take a tour</a>.
            </div>
            <div class="alert alert-info alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>You are logged in as superuser <a href="./account/info">eric.bechtel</a>.</div>
            <div class="row">-->

            <!-- service status panel -->
            <div class="col-md-3">
                <ul class="nav nav-stacked main-nav">
                    <li role="presentation" class="active"><a href="/console/#/" class="first" data-target="#main">Future Date Range by Market</a></li>
                    <li role="presentation"><a href="/console/#/history.html" data-target="#history">Historical by Market</a></li>
                    <li role="presentation"><a href="/console/#/demand.html" data-target="#demand">Demand by Search Date Range</a></li>
                </ul>
            </div>
            <!-- end status panel -->

            <!-- concurrent queries panel -->
            <!--<div class="col-md-4">
            <div class="panel panel-default" style="background-color:#008AAA;color:white;">
              <div class="panel-body text-center">
                    <p>You Have</p>
                <h1 style="font-size:72px;margin-top:-10px;">127</h1>
                    <p style="margin-top:-5px;">Live Concurrent Queries (All Services)</p>
              </div>
            </div>
            </div>-->
            <!-- end concurrent queries panel -->

            <div style="display: none">
                <div id="carrierGroups" class="groups-block">
                    <div class="btn-group toggle-buttons-block" data-toggle="buttons">
                        <label class="btn btn-default active">
                            <input type="radio" class="toggle-buttons" autocomplete="off" checked value="all"> All Airlines
                        </label>
                        <label class="btn btn-default">
                            <input type="radio" class="toggle-buttons" autocomplete="off" value="none"> None
                        </label>
                    </div>
                    <select class="form-control carrier-groups" multiple="multiple"></select>
                </div>
            </div>

            <div id="view"></div>

        </div>

    </div>

</body>

<script type="text/javascript">

    require(['/js/config.js'], function() {
        require(['jsPDF', 'jquery', 'bootstrap', 'html2canvas', 'common', 'moment', 'daterangepicker', 'multiselect'], function() {

            var $body = $('body');
            var $view = $('#view');
            var $navLinks = $('.main-nav a');
            var path = location.hash.replace(/#/, '');
            var basePath = '/console';
            var link = basePath + '/#' + (path || '/');

            window.defaultCarrierGroup = 'all';
            window.defaultCarrier = 'SA';
            var userData = localStorage.getItem('auth');
            var userCarrierGroups = [];
            if(userData){
                window.defaultCarrier = JSON.parse(userData).defaultCarrier || 'SA';
                userCarrierGroups = JSON.parse(userData).carrierGroups || [];
            }
            window.userCarrierGroups = userCarrierGroups;
            var optionsGroups = '';
            var groupsLabels = Object.keys(userCarrierGroups);
            for(var i in groupsLabels){
                var label = groupsLabels[i];
                optionsGroups += '<optgroup label="' + label + '">';
                for(var j in userCarrierGroups[label]){
                    var airline = userCarrierGroups[label][j];
                    if(airline == window.defaultCarrier) { continue; }
                    optionsGroups += '<option value="' + i + '-' + airline+ '">' + airline + '</option>';
                }
                optionsGroups += '</optgroup>';
            }

            var $carrierGroups = $body.find('#carrierGroups').find('select');
            $carrierGroups.html(optionsGroups);

            //todo fix main page loads two times
            $body.on('click', '.main-nav a', function(){ // here is should not use $navLinks because $(this) became body

                var $self = $(this);
                var path = $self.attr('href');
                $navLinks.removeClass('active');
                $self.addClass('active');

                $body.find('.page').hide();
                var $page = $($self.data('target'));
                if($page.length){
                    $page.show();
                } else {
                    //show loader
                    switch(path){
                        case basePath + '/#/history.html':
                            load('history');
                            break;
                        case basePath + '/#/demand.html':
                            load('demand');
                            break;
                        case basePath + '/#/':
                        default:
                            load('main');
                    }
                }

            });

            $body.on('click', '#logout', function(){
                localStorage.removeItem('auth'); //may be make logout from API
                location.pathname = '/login';
            });

            $body.on('change', '.carrier-groups', function(){
                var page = $(this).parents('.groups-block').data('page');
                var pageId = '#' + page.toLowerCase();

                //-------------------------reset
                $(pageId + ' .toggle-buttons').each(function() {
                    $(this).prop('checked', false);
                });
                $(pageId + ' [data-toggle="buttons"]').find('label').removeClass('active');
                //------------------------------

                var group = getCheckedArr('.groups-wrapper-' + page.toLowerCase());
                window['selectedGroup' + page] = group;

                $body.trigger('selectedGroup' + page);
            });

            $body.on('click', '.toggle-buttons-block', function(e){
                var page = $(this).parents('.groups-block').data('page');
                var pageId = '#' + page.toLowerCase();

                $(pageId + ' .carrier-groups option:selected').each(function() {
                    $(this).prop('selected', false);
                });
                $(pageId + ' .toggle-buttons').each(function() {
                    $(this).prop('checked', false);
                });
                $(e.target).find('.toggle-buttons').prop('checked', true);
                $(pageId + ' .carrier-groups').multiselect('refresh');

                var group = getCheckedArr('.groups-wrapper-' + page.toLowerCase());
                window['selectedGroup' + page] = group;

                $body.trigger('selectedGroup' + page);
            });

            $body.on('click', '.remove-airline', function(){
                var page = $(this).parents('.page').attr('id');
                var name = 'selectedGroup' + page[0].toUpperCase() + page.substr(1);
                var airline = $(this).data('airline');
                if(!(window[name] && window[name].indexOf('all') === -1)){
                    if(page == 'history'){
                        window[name] = Object.keys(window.globalDataHistory.data);
                    } else {
                        window[name] = Object.keys(window.globalData.data);
                    }
                }
                window[name].splice(window[name].indexOf(airline), 1);
                $body.trigger(name);
            });

            $body.on('multiselect-ready', function(event, id){
                $('#' + id + ' .carrier-groups').multiselect({
                    maxHeight: 200,
                    includeSelectAllOption: false,
                    enableFiltering: true,
                    enableClickableOptGroups: true,
                    enableCaseInsensitiveFiltering: true,
                    buttonWidth: '150px'
                });
            });

            $('.main-nav a[href="' + link + '"]').trigger('click'); //trigger when page loads

            function getCheckedArr(selector){
                var vals = {};
                $(selector).find(':checked').each(function(index, item){
                    var val = $(this).val();
                    var dash = val.indexOf('-');
                    if(dash !== -1){
                        val = val.substr(dash+1);
                    }
                    vals[val] = true;
                });
                vals[window.defaultCarrier] = true;

                return Object.keys(vals);
            }

            function load(page){

                $.get('/pages/' + page + '.html').done(function(data){
                    //hide loader
                    $view.append(data);
                    require([page]);
                }).fail(function(error){
                    console.warn(error);
                });

            }

        }); //end

    });

</script>
</html>
